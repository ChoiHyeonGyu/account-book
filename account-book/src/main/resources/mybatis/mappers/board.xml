<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	<select id="usernameselect" parameterType="string" resultType="string">
		<![CDATA[
			select name from users where id = #{value}
		]]>
	</select>

	<insert id="boardinsert" parameterType="boardvo">
		<![CDATA[
			insert into board values(seq_board.nextval, #{id}, #{month}, #{title}, #{content}, #{name}, sysdate, 0, 0)
		]]>
	</insert>

	<select id="boardidselect" parameterType="boardvo" resultType="int">
		<![CDATA[
			select board_id from board where id = #{id} and month = #{month} and title = #{title} 
		]]>
		<if test="content != null and content != ''">
			<![CDATA[
				and content = #{content}
			]]>
		</if>
	</select>

	<insert id="imageinsert" parameterType="boardvo">
		<![CDATA[
			insert into picture values(#{photo}, #{boardId})
		]]>
	</insert>

	<select id="contentselect" parameterType="int" resultType="boardvo">
		<![CDATA[
			select board.board_id as boardId, board.*, picture.photo from board, picture where board.board_id = picture.board_id and board.board_id = #{value}
		]]>
	</select>

	<update id="boardupdate" parameterType="boardvo">
		<![CDATA[
			update board set month = #{month}, title = #{title}, content = #{content} where board_id = #{boardId}
		]]>
	</update>

	<select id="imageselect" parameterType="int" resultType="boardvo">
		<![CDATA[
			select photo from picture where board_id = #{value}
		]]>
	</select>

	<delete id="imagedelete" parameterType="int">
		<![CDATA[
			delete from picture where board_id = #{value}
		]]>
	</delete>

	<delete id="boarddelete" parameterType="int">
		<![CDATA[
			delete from board where board_id = #{value}
		]]>
	</delete>

	<select id="boardcount" parameterType="string" resultType="int">
		<![CDATA[
			select count(*) from board
		]]>
		<if test="_parameter != null and _parameter != ''">
			<![CDATA[
				where month like '%${_parameter}%' or title like '%${_parameter}%' or name like '%${_parameter}%'
			]]>
		</if>
	</select>

	<select id="getList" parameterType="map" resultType="boardvo">
    	<![CDATA[
			select * from (select a.*, rownum as rn from (select board_id as boardId, board.* from board 
		]]>
		<if test="keyword != null and keyword != ''">
			<![CDATA[					  
				where (month like '%${keyword}%' or title like '%${keyword}%' or name like '%${keyword}%') 
			]]>
		</if>
		<![CDATA[					  
			order by board.day desc) a) where (#{page}-1)*#{size}+1 <= rn and rn <= #{page}*#{size}
		]]>
	</select>
	
	<select id="commentsselect" parameterType="int" resultType="boardvo">
		<![CDATA[
			select comments.comment_id as commentId, comments.* from boardcomments, comments where boardcomments.comment_id = comments.comment_id and boardcomments.board_id = #{value}
		]]>
	</select>
	
	<insert id="commentinsert" parameterType="boardvo">
		<![CDATA[
			insert into comments values(seq_comments.nextval, #{id}, #{name}, sysdate, #{content}, '')
		]]>
	</insert>
	
	<select id="commentidselect" parameterType="boardvo" resultType="int">
		<![CDATA[
			select comment_id from comments where id = #{id} and content = #{content}
		]]>
	</select>
	
	<insert id="boardcommentsinsert" parameterType="boardvo">
		<![CDATA[
			insert into boardcomments values(#{boardId}, #{commentId})
		]]>
	</insert>
	
	<select id="replysselect" parameterType="int" resultType="boardvo">
		<![CDATA[
			select comments.comment_id as commentId, comments.* from comments where reply = #{value}
		]]>
	</select>
	
	<insert id="replyinsert" parameterType="boardvo">
		<![CDATA[
			insert into comments values(seq_comments.nextval, #{id}, #{name}, sysdate, #{content}, #{commentId})
		]]>
	</insert>
	
	<delete id="boardcommentsdelete" parameterType="int">
		<![CDATA[
			delete from boardcomments where comment_id = #{value}
		]]>
	</delete>
	
	<delete id="commentdelete" parameterType="int">
		<![CDATA[
			delete from comments where comment_id = #{value} or reply = #{value}
		]]>
	</delete>
	
	<update id="hit" parameterType="int">
		update board set hit = hit + 1 where board_id = #{value}
	</update>
	
	<select id="gdselect" parameterType="boardvo" resultType="int">
		<![CDATA[
			select count(*) from GD where board_id = #{boardId} and id = #{id}
		]]>
	</select>
	
	<insert id="gdinsert" parameterType="boardvo">
		<![CDATA[
			insert into GD values(#{boardId}, #{id})
		]]>
	</insert>
	
	<delete id="gddelete" parameterType="int">
		<![CDATA[
			delete from GD where board_id = #{value}
		]]>
	</delete>
	
	<update id="good" parameterType="int">
		<![CDATA[
			update board set good = good + 1 where board_id = #{value}
		]]>
	</update>
	
	<!-- <select id="graphavgdefaultselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select sum(cnt) as cnt, category from (select count(*) as cnt, c.category as category from (select id from (select gender, age from users where id = #{value}) a, 
			users where users.gender = a.gender and users.age = a.age) b, list, category c where b.id = list.id and list.operations = '-' and list.category = c.category and c.slave_id = 0 
			and list.day between trunc(sysdate, 'yy') and trunc(add_months(sysdate, 12), 'yy')-1/86400 group by c.category union all
			select count(*) as cnt, c2.category as category from (select id from (select gender, age from users where id = #{value}) a, 
			users where users.gender = a.gender and users.age = a.age) b, list, category c1, category c2 where b.id = list.id and list.operations = '-' and list.category = c1.category 
			and c1.slave_id = c2.category_id and list.day between trunc(sysdate, 'yy') and trunc(add_months(sysdate, 12), 'yy')-1/86400 group by c2.category) 
			group by category order by cnt desc
		]]>
	</select> -->
	
	<select id="limitgraphselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select * from (select category, money_limit as ml from category c, userscategory uc where c.category_id = uc.category_id and id = #{value}) a,
			(select category, sum(money) as lsum from list where id = #{value} and day between trunc(sysdate, 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category order by a.category
		]]>
	</select>
	
	<select id="movelimitgraphselect" parameterType="map" resultType="graphvo">
		<![CDATA[
			select * from (select category, money_limit as ml from category c, userscategory uc where c.category_id = uc.category_id and id = #{id}) a,
			(select category, sum(money) as lsum from list where id = #{id} and day between trunc(add_months(sysdate, #{operation}), 'mm') and 
			trunc(add_months(sysdate, #{operation}+1), 'mm') -1/86400 and operations = '-' group by category) b where a.category = b.category order by a.category
		]]>
	</select>
	
	<!-- String에서 숫자만 뽑아내기 translate(money, '0123456789' || money, '0123456789') -->
	
	<select id="importgraphselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select sum(money) as lsum, category, day as day1 from list where id = #{value} and operations = '+'
			and day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by category, day order by day
		]]>
	</select>
	
	<select id="exportgraphselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select sum(money) as lsum, category, day as day1 from list where id = #{value} and operations = '-'
			and day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by category, day order by day
		]]>
	</select>
	
	<select id="imreporttableselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select rt.category, to_char(sum(a), '999,999,999,999,999') Jan, to_char(sum(b), '999,999,999,999,999') Feb, to_char(sum(c), '999,999,999,999,999') Mar, 
			to_char(sum(d), '999,999,999,999,999') Apr, to_char(sum(e), '999,999,999,999,999') May, to_char(sum(f), '999,999,999,999,999') Jun, to_char(sum(g), '999,999,999,999,999') Jul, 
			to_char(sum(h), '999,999,999,999,999') Aug, to_char(sum(i), '999,999,999,999,999') Sep, to_char(sum(j), '999,999,999,999,999') Oct, to_char(sum(k), '999,999,999,999,999') Nov, 
			to_char(sum(l), '999,999,999,999,999') Dec, to_char(sum(a)+sum(b)+sum(c)+sum(d)+sum(e)+sum(f)+sum(g)+sum(h)+sum(i)+sum(j)+sum(k)+sum(l), '999,999,999,999,999') as sumresult
			from (select category, 
				 nvl(case when day between trunc(add_months(sysdate, -11), 'mm') and trunc(add_months(sysdate, -10), 'mm') -1/86400 then sum(money) end, 0) a, 
				 nvl(case when day between trunc(add_months(sysdate, -10), 'mm') and trunc(add_months(sysdate, -9), 'mm') -1/86400 then sum(money) end, 0) b, 
				 nvl(case when day between trunc(add_months(sysdate, -9), 'mm') and trunc(add_months(sysdate, -8), 'mm') -1/86400 then sum(money) end, 0) c, 
				 nvl(case when day between trunc(add_months(sysdate, -8), 'mm') and trunc(add_months(sysdate, -7), 'mm') -1/86400 then sum(money) end, 0) d, 
				 nvl(case when day between trunc(add_months(sysdate, -7), 'mm') and trunc(add_months(sysdate, -6), 'mm') -1/86400 then sum(money) end, 0) e, 
				 nvl(case when day between trunc(add_months(sysdate, -6), 'mm') and trunc(add_months(sysdate, -5), 'mm') -1/86400 then sum(money) end, 0) f, 
				 nvl(case when day between trunc(add_months(sysdate, -5), 'mm') and trunc(add_months(sysdate, -4), 'mm') -1/86400 then sum(money) end, 0) g, 
				 nvl(case when day between trunc(add_months(sysdate, -4), 'mm') and trunc(add_months(sysdate, -3), 'mm') -1/86400 then sum(money) end, 0) h, 
				 nvl(case when day between trunc(add_months(sysdate, -3), 'mm') and trunc(add_months(sysdate, -2), 'mm') -1/86400 then sum(money) end, 0) i, 
				 nvl(case when day between trunc(add_months(sysdate, -2), 'mm') and trunc(add_months(sysdate, -1), 'mm') -1/86400 then sum(money) end, 0) j, 
				 nvl(case when day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 then sum(money) end, 0) k, 
				 nvl(case when day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 then sum(money) end, 0) l 
			from list where id = #{value} and operations = '+' group by category, day) rt group by rt.category
		]]>
	</select>
	
	<select id="imreporttablesumselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select to_char(sum(a), '999,999,999,999,999') Jan, to_char(sum(b), '999,999,999,999,999') Feb, to_char(sum(c), '999,999,999,999,999') Mar, 
			to_char(sum(d), '999,999,999,999,999') Apr, to_char(sum(e), '999,999,999,999,999') May, to_char(sum(f), '999,999,999,999,999') Jun, to_char(sum(g), '999,999,999,999,999') Jul, 
			to_char(sum(h), '999,999,999,999,999') Aug, to_char(sum(i), '999,999,999,999,999') Sep, to_char(sum(j), '999,999,999,999,999') Oct, to_char(sum(k), '999,999,999,999,999') Nov, 
			to_char(sum(l), '999,999,999,999,999') Dec, to_char(sum(a)+sum(b)+sum(c)+sum(d)+sum(e)+sum(f)+sum(g)+sum(h)+sum(i)+sum(j)+sum(k)+sum(l), '999,999,999,999,999') as sumresult 
			from (select category, 
				 nvl(case when day between trunc(add_months(sysdate, -11), 'mm') and trunc(add_months(sysdate, -10), 'mm') -1/86400 then sum(money) end, 0) a, 
				 nvl(case when day between trunc(add_months(sysdate, -10), 'mm') and trunc(add_months(sysdate, -9), 'mm') -1/86400 then sum(money) end, 0) b, 
				 nvl(case when day between trunc(add_months(sysdate, -9), 'mm') and trunc(add_months(sysdate, -8), 'mm') -1/86400 then sum(money) end, 0) c, 
				 nvl(case when day between trunc(add_months(sysdate, -8), 'mm') and trunc(add_months(sysdate, -7), 'mm') -1/86400 then sum(money) end, 0) d, 
				 nvl(case when day between trunc(add_months(sysdate, -7), 'mm') and trunc(add_months(sysdate, -6), 'mm') -1/86400 then sum(money) end, 0) e, 
				 nvl(case when day between trunc(add_months(sysdate, -6), 'mm') and trunc(add_months(sysdate, -5), 'mm') -1/86400 then sum(money) end, 0) f, 
				 nvl(case when day between trunc(add_months(sysdate, -5), 'mm') and trunc(add_months(sysdate, -4), 'mm') -1/86400 then sum(money) end, 0) g, 
				 nvl(case when day between trunc(add_months(sysdate, -4), 'mm') and trunc(add_months(sysdate, -3), 'mm') -1/86400 then sum(money) end, 0) h, 
				 nvl(case when day between trunc(add_months(sysdate, -3), 'mm') and trunc(add_months(sysdate, -2), 'mm') -1/86400 then sum(money) end, 0) i, 
				 nvl(case when day between trunc(add_months(sysdate, -2), 'mm') and trunc(add_months(sysdate, -1), 'mm') -1/86400 then sum(money) end, 0) j, 
				 nvl(case when day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 then sum(money) end, 0) k, 
				 nvl(case when day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 then sum(money) end, 0) l 
			from list where id = #{value} and operations = '+' group by category, day) rt
		]]>
	</select>
	
	<select id="exreporttableselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select rt.category, to_char(sum(a), '999,999,999,999,999') Jan, to_char(sum(b), '999,999,999,999,999') Feb, to_char(sum(c), '999,999,999,999,999') Mar, 
			to_char(sum(d), '999,999,999,999,999') Apr, to_char(sum(e), '999,999,999,999,999') May, to_char(sum(f), '999,999,999,999,999') Jun, to_char(sum(g), '999,999,999,999,999') Jul, 
			to_char(sum(h), '999,999,999,999,999') Aug, to_char(sum(i), '999,999,999,999,999') Sep, to_char(sum(j), '999,999,999,999,999') Oct, to_char(sum(k), '999,999,999,999,999') Nov, 
			to_char(sum(l), '999,999,999,999,999') Dec, to_char(sum(a)+sum(b)+sum(c)+sum(d)+sum(e)+sum(f)+sum(g)+sum(h)+sum(i)+sum(j)+sum(k)+sum(l), '999,999,999,999,999') as sumresult
			from (select category, 
				 nvl(case when day between trunc(add_months(sysdate, -11), 'mm') and trunc(add_months(sysdate, -10), 'mm') -1/86400 then sum(money) end, 0) a, 
				 nvl(case when day between trunc(add_months(sysdate, -10), 'mm') and trunc(add_months(sysdate, -9), 'mm') -1/86400 then sum(money) end, 0) b, 
				 nvl(case when day between trunc(add_months(sysdate, -9), 'mm') and trunc(add_months(sysdate, -8), 'mm') -1/86400 then sum(money) end, 0) c, 
				 nvl(case when day between trunc(add_months(sysdate, -8), 'mm') and trunc(add_months(sysdate, -7), 'mm') -1/86400 then sum(money) end, 0) d, 
				 nvl(case when day between trunc(add_months(sysdate, -7), 'mm') and trunc(add_months(sysdate, -6), 'mm') -1/86400 then sum(money) end, 0) e, 
				 nvl(case when day between trunc(add_months(sysdate, -6), 'mm') and trunc(add_months(sysdate, -5), 'mm') -1/86400 then sum(money) end, 0) f, 
				 nvl(case when day between trunc(add_months(sysdate, -5), 'mm') and trunc(add_months(sysdate, -4), 'mm') -1/86400 then sum(money) end, 0) g, 
				 nvl(case when day between trunc(add_months(sysdate, -4), 'mm') and trunc(add_months(sysdate, -3), 'mm') -1/86400 then sum(money) end, 0) h, 
				 nvl(case when day between trunc(add_months(sysdate, -3), 'mm') and trunc(add_months(sysdate, -2), 'mm') -1/86400 then sum(money) end, 0) i, 
				 nvl(case when day between trunc(add_months(sysdate, -2), 'mm') and trunc(add_months(sysdate, -1), 'mm') -1/86400 then sum(money) end, 0) j, 
				 nvl(case when day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 then sum(money) end, 0) k, 
				 nvl(case when day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 then sum(money) end, 0) l 
			from list where id = #{value} and operations = '-' group by category, day) rt group by rt.category
		]]>
	</select>
	
	<select id="exreporttablesumselect" parameterType="string" resultType="graphvo">
		<![CDATA[
			select to_char(sum(a), '999,999,999,999,999') Jan, to_char(sum(b), '999,999,999,999,999') Feb, to_char(sum(c), '999,999,999,999,999') Mar, 
			to_char(sum(d), '999,999,999,999,999') Apr, to_char(sum(e), '999,999,999,999,999') May, to_char(sum(f), '999,999,999,999,999') Jun, to_char(sum(g), '999,999,999,999,999') Jul, 
			to_char(sum(h), '999,999,999,999,999') Aug, to_char(sum(i), '999,999,999,999,999') Sep, to_char(sum(j), '999,999,999,999,999') Oct, to_char(sum(k), '999,999,999,999,999') Nov, 
			to_char(sum(l), '999,999,999,999,999') Dec, to_char(sum(a)+sum(b)+sum(c)+sum(d)+sum(e)+sum(f)+sum(g)+sum(h)+sum(i)+sum(j)+sum(k)+sum(l), '999,999,999,999,999') as sumresult 
			from (select category, 
				 nvl(case when day between trunc(add_months(sysdate, -11), 'mm') and trunc(add_months(sysdate, -10), 'mm') -1/86400 then sum(money) end, 0) a, 
				 nvl(case when day between trunc(add_months(sysdate, -10), 'mm') and trunc(add_months(sysdate, -9), 'mm') -1/86400 then sum(money) end, 0) b, 
				 nvl(case when day between trunc(add_months(sysdate, -9), 'mm') and trunc(add_months(sysdate, -8), 'mm') -1/86400 then sum(money) end, 0) c, 
				 nvl(case when day between trunc(add_months(sysdate, -8), 'mm') and trunc(add_months(sysdate, -7), 'mm') -1/86400 then sum(money) end, 0) d, 
				 nvl(case when day between trunc(add_months(sysdate, -7), 'mm') and trunc(add_months(sysdate, -6), 'mm') -1/86400 then sum(money) end, 0) e, 
				 nvl(case when day between trunc(add_months(sysdate, -6), 'mm') and trunc(add_months(sysdate, -5), 'mm') -1/86400 then sum(money) end, 0) f, 
				 nvl(case when day between trunc(add_months(sysdate, -5), 'mm') and trunc(add_months(sysdate, -4), 'mm') -1/86400 then sum(money) end, 0) g, 
				 nvl(case when day between trunc(add_months(sysdate, -4), 'mm') and trunc(add_months(sysdate, -3), 'mm') -1/86400 then sum(money) end, 0) h, 
				 nvl(case when day between trunc(add_months(sysdate, -3), 'mm') and trunc(add_months(sysdate, -2), 'mm') -1/86400 then sum(money) end, 0) i, 
				 nvl(case when day between trunc(add_months(sysdate, -2), 'mm') and trunc(add_months(sysdate, -1), 'mm') -1/86400 then sum(money) end, 0) j, 
				 nvl(case when day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 then sum(money) end, 0) k, 
				 nvl(case when day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 then sum(money) end, 0) l 
			from list where id = #{value} and operations = '-' group by category, day) rt
		]]>
	</select>
	
	<select id="dateselect" resultType="graphvo">
		<![CDATA[
			select to_char(trunc(add_months(sysdate, -11), 'mm'), 'YYYY/mm') Jan, 
					 to_char(trunc(add_months(sysdate, -10), 'mm'), 'YYYY/mm') Feb, 
					 to_char(trunc(add_months(sysdate, -9), 'mm'), 'YYYY/mm') Mar, 
					 to_char(trunc(add_months(sysdate, -8), 'mm'), 'YYYY/mm') Apr, 
					 to_char(trunc(add_months(sysdate, -7), 'mm'), 'YYYY/mm') May, 
					 to_char(trunc(add_months(sysdate, -6), 'mm'), 'YYYY/mm') Jun, 
					 to_char(trunc(add_months(sysdate, -5), 'mm'), 'YYYY/mm') Jul, 
					 to_char(trunc(add_months(sysdate, -4), 'mm'), 'YYYY/mm') Aug, 
					 to_char(trunc(add_months(sysdate, -3), 'mm'), 'YYYY/mm') Sep, 
					 to_char(trunc(add_months(sysdate, -2), 'mm'), 'YYYY/mm') Oct, 
					 to_char(trunc(add_months(sysdate, -1), 'mm'), 'YYYY/mm') Nov, 
					 to_char(trunc(add_months(sysdate, 0), 'mm'), 'YYYY/mm') Dec 	 
			from dual
		]]>
	</select>
	
	<select id="graphjinanmonthselect" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<!-- select sum(cnt) as cnt, category from (select count(*) as cnt, c.category as category from (select id from (select gender, age from users where id = #{value}) a, 
			users where users.gender = a.gender and users.age = a.age) b, list, category c where b.id = list.id and list.operations = '-' and list.category = c.category and c.slave_id = 0 
			and list.day between trunc(sysdate, 'yy') and trunc(add_months(sysdate, 12), 'yy')-1/86400 group by c.category union all
			select count(*) as cnt, c2.category as category from (select id from (select gender, age from users where id = #{value}) a, 
			users where users.gender = a.gender and users.age = a.age) b, list, category c1, category c2 where b.id = list.id and list.operations = '-' and list.category = c1.category 
			and c1.slave_id = c2.category_id and list.day between trunc(sysdate, 'yy') and trunc(add_months(sysdate, 12), 'yy')-1/86400 group by c2.category) 
			group by category order by cnt desc -->
	
	<select id="graphjinanmonthselect1" parameterType="map" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect1" parameterType="map" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect1" parameterType="map" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect1" parameterType="map" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphjinanmonthselect2" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect2" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect2" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect2" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphjinanmonthselect3" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect3" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect3" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect3" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphjinanmonthselect4" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect4" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect4" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect4" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphjinanmonthselect5" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect5" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect5" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect5" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphjinanmonthselect6" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect6" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect6" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect6" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphjinanmonthselect7" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="graphttmonthselect7" resultType="graphvo">
		<![CDATA[
			select rownum, cnt, category from (select sum(cnt) as cnt, category from 
			(select count(*) as cnt, c.category from list, category c where list.category = c.category and c.slave_id = 0 and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c.category union all
			select count(*) as cnt, c2.category from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			list.day between trunc(add_months(sysdate, 0), 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400 and operations = '-'
			group by c2.category) group by category order by cnt desc, category) where rownum < 11
		]]>
	</select>
	
	<select id="allexportgraphselect7" resultType="graphvo">
		<![CDATA[
			select * from (select avg(list.money) as lsum, c.category, list.day as day1 from list, category c where list.category = c.category and c.slave_id = 0 and operations = '-' 
			and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c.category, list.day union all
			select avg(money) as lsum, c2.category, list.day as day1 from list, category c1, category c2 where list.category = c1.category and c1.slave_id = c2.category_id and 
			operations = '-' and list.day between trunc(add_months(sysdate, -12), 'mm') and trunc(sysdate, 'dd') group by c2.category, list.day) order by day1, lsum desc
		]]>
	</select>
	
	<select id="alllimitgraphselect7" resultType="graphvo">
		<![CDATA[
			select rownum, category, ml, lsum from (select category, sum(ml) as ml, sum(lsum) as lsum from 
			(select a.category, a.ml, b.lsum from (select category, avg(money_limit) as ml from category c, userscategory uc where c.category_id = uc.category_id and slave_id = 0 
			group by category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.category = b.category union all 
			select a.category, a.ml, b.lsum from (select c1.category as cate, c2.category, avg(money_limit) as ml from category c1, category c2, userscategory uc 
			where c1.category_id = uc.category_id and c1.slave_id = c2.category_id group by c1.category, c2.category) a,
			(select category, floor(avg(money)) as lsum from list where day between trunc(add_months(sysdate, -1), 'mm') and trunc(add_months(sysdate, 0), 'mm') -1/86400 and operations = '-'
			group by category) b where a.cate = b.category) group by category order by lsum desc, category) where rownum < 11
		]]>
	</select>
</mapper>