<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="listview">

	<select id="list" resultType="listvo">
<![CDATA[
select list_id as listId,id,paid,bank,operations,money,name,category,DAY,locationX,locationY from list where id = #{id}
 ]]>
	</select>

	<delete id="delete" parameterType="listvo">
	
<![CDATA[
delete from list where id = #{id} and list_Id = #{listId}

]]>

	</delete>


	<insert id="add" parameterType="listvo">
	
	
	<![CDATA[
	
	insert INTO list (LIST_ID, ID, PAID, BANK, OPERATIONS, MONEY, NAME, CATEGORY, DAY)
values (seq_list.nextval,#{id},#{paid},#{bank}, #{operations},#{money}, #{name},#{category},#{day})
	]]>
	</insert>

	<select id="modify" parameterType="int" resultType="listvo">
 		<![CDATA[
 			select list_id as listId, paid,bank,operations,money,name,category from list where list_id=#{listId}
 		]]>
	</select>
	
	<update id="modify1" parameterType="listvo" >
 		<![CDATA[
		update list set paid=#{paid},
 		bank=#{bank},operations=#{operations},money=#{money},name=#{name},category=#{category}
 		 where list_Id=#{listId} 	 	
 	 	]]>
	</update>
	
	<update id="modify2" parameterType="map" >
 		<![CDATA[
		update list set day = #{day}
 		 where list_Id=#{listId} 	 	
 	 	]]>
	</update>
	
	<update id="modify3" parameterType="map" >
 		<![CDATA[
		update list set name = #{infovo}
 		 where list_Id=#{id} 	 	
 	 	]]>
	</update>
	
	<update id="modify4" parameterType="map" >
 		<![CDATA[
		update list set money = #{money}
 		 where list_Id=#{id} 	 	
 	 	]]>
	</update>
	
	<update id="modify5" parameterType="map" >
 		<![CDATA[
		update list set bank = #{info}
 		 where list_Id=#{id} 	 	
 	 	]]>
	</update>
	<update id="modify6" parameterType="map" >
 		<![CDATA[
		update list set paid = #{info}
 		 where list_Id=#{id} 	 	
 	 	]]>
	</update>
	<update id="modify7" parameterType="map" >
 		<![CDATA[
		update list set operations = #{info}
 		 where list_Id=#{id} 	 	
 	 	]]>
	</update>
	<update id="modify8" parameterType="map" >
 		<![CDATA[
		update list set category = #{info}
 		 where list_Id=#{id} 	 	
 	 	]]>
	</update>
	
	<select id="dealwithsearching" parameterType="map" resultType="int">
		<![CDATA[
			select count(*) from list where id = #{id} and day between trunc(add_months(sysdate, #{operation}), 'mm') and trunc(add_months(sysdate, #{operation}+1), 'mm') -1/86400
		]]>
		<if test="searching !=null and searching !=''">
			<![CDATA[
				and name like '%${searching}%' or category like '%${searching}%' or paid like '%${searching}%' or money like '%${searching}%' 
			]]>
		</if>
	</select> 
	
	<select id="movelistselect" parameterType="map" resultType="listvo">
		<![CDATA[
			select * from (
			select a.*, rownum as rn from (select list_id as listId, to_char(to_date(day, 'YY/MM/DD'), 'yyYY/MM/DD') as day, category, bank, 
			(case when operations='+' then '수입' when operations='-' then '지출' when operations='0' then '투자' end) as operations, paid, locationX, locationY, name, 
			to_char(money, '999,999,999,999,999') as moneyresult from list where id = #{id}
			and day between trunc(add_months(sysdate, #{operation}), 'mm') and trunc(add_months(sysdate, #{operation}+1), 'mm') -1/86400
		]]>
		<if test="searching != null and searching !=''"> 
			<![CDATA[					  
				and (name like '%${searching}%' or category like '%${searching}%' or paid like '%${searching}%' or money like '%${searching}%') 
			]]>
		</if>
		<![CDATA[					  
			order by list.day desc) a) where (#{page}-1)*#{listSize}+1 <= rn and rn <= #{page}*#{listSize}
		]]>
	</select>

	<select id="selectlocation" parameterType="int" resultType="listvo">
		<![CDATA[
			select * from list where list_id = #{value}
		]]>
	</select>
	
	<select id="totalmonth" parameterType="map" resultType="listvo">
		<![CDATA[
select to_char(nvl(sum(money),0), '999,999,999,999,999') as moneyresult from list where id = #{id} and  operations='-' and day between trunc(add_months(sysdate, #{operation}), 'mm') and trunc(add_months(sysdate, #{operation}+1), 'mm') -1/86400		]]>
	</select>
	<select id="totalmonth1" parameterType="map" resultType="listvo">
		<![CDATA[
select to_char(nvl(sum(money),0), '999,999,999,999,999') as moneyresult from list where id = #{id} and  operations='+' and day between trunc(add_months(sysdate, #{operation}), 'mm') and trunc(add_months(sysdate, #{operation}+1), 'mm') -1/86400		]]>
	</select>
	
</mapper>