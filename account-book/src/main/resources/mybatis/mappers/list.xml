<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="listview">

	<select id="list" resultType="listvo">
<![CDATA[
select list_id as listId,id,paid,bank,operations,money,name,category,DAY,locationX,locationY from list where id = #{id}
 ]]>
	</select>

	<delete id="delete" parameterType="listvo">
	
<![CDATA[
delete from list where id = #{id} and list_Id = #{listId}

]]>

	</delete>


	<insert id="add" parameterType="listvo">
	
	
	<![CDATA[
	
	insert INTO list (LIST_ID, ID, PAID, BANK, OPERATIONS, MONEY, NAME, CATEGORY, DAY)
values (seq_list.nextval,#{id},#{paid},#{bank}, #{operations},#{money}, #{name},#{category},#{day})
	]]>
	</insert>

	<select id="modify" parameterType="int" resultType="listvo">
 		<![CDATA[
 			select list_id as listId, paid,bank,operations,money,name,category from list where list_id=#{listId}
 		]]>
	</select>
	
	<update id="modify1" parameterType="listvo" >
 		<![CDATA[
		update list set paid=#{paid},
 		bank=#{bank},operations=#{operations},money=#{money},name=#{name},category=#{category}
 		 where list_Id=#{listId} 	 	
 	 	]]>
	</update>
	
	<select id="dealwithsearching" parameterType="string" resultType="int">
		<![CDATA[
			select count(*) from list
		]]>
		<if test="_parameter !=null and _parameter !=''">
			<![CDATA[
				where name like '%${_parameter}%' or category like '%${_parameter}%' or paid like '%${_parameter}%' or money like '%${_parameter}%' 
			]]>
		</if>
	</select> 
	
		<select id="totallist" parameterType="map" resultType="listvo">
    	<![CDATA[
			select * from (
			select a.*, rownum as rn from (select list_id as listId, to_char(to_date(day, 'YY/MM/DD'), 'yyYY/MM/DD') as day, category, bank, operations, paid, locationX, locationY, name, money from list where id = #{id}
		]]>
		<if test="searching != null and searching !=''"> 
			<![CDATA[					  
				and (name like '%${searching}%' or category like '%${searching}%' or paid like '%${searching}%' or money like '%${searching}%') 
			]]>
		</if>
		<![CDATA[					  
			order by list.day desc) a) where (#{page}-1)*#{listSize}+1 <= rn and rn <= #{page}*#{listSize}
		]]>
	</select>

	<select id="selectlocation" parameterType="int" resultType="listvo">
		<![CDATA[
			select * from list where list_id = #{value}
		]]>
	</select>
	
	<select id="totalmonth" parameterType="String" resultType="listvo">
		<![CDATA[
	SELECT sum(money) as totalmonth FROM list where id ='streats' and operations='-' and day between trunc(sysdate, 'mm') and trunc(add_months(sysdate, 1), 'mm') -1/86400
		]]>
	</select>
	
</mapper>